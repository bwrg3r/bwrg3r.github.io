<!DOCTYPE html><html lang="en-US"> <head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"><meta name="generator" content="Astro v5.5.6"><meta name="robots" content="index, follow"><meta name="HandheldFriendly" content="True"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: light)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="manifest" href="/site.webmanifest"><link rel="alternate" type="application/rss+xml" title="bWrg3r" href="https://bwrg3r.github.io/rss.xml"><link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="shortcut icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><meta name="apple-mobile-web-app-title" content="bWrg3r"><link rel="manifest" href="/site.webmanifest"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CMTcOisY.js"></script><title>UMCS CTF 2025 Finals | bWrg3r</title><meta name="title" content="UMCS CTF 2025 Finals | bWrg3r"><meta name="description" content="A compilation of UMCS CTF 2025 Finals Writeups"><link rel="canonical" href="https://bwrg3r.github.io/"><meta property="og:title" content="UMCS CTF 2025 Finals"><meta property="og:description" content="A compilation of UMCS CTF 2025 Finals Writeups"><meta property="og:image" content="https://bwrg3r.github.io//_astro/logo.BVICYRoW.png"><meta property="og:image:alt" content="UMCS CTF 2025 Finals"><meta property="og:type" content="website"><meta property="og:locale" content="en-US"><meta property="og:site_name" content="bWrg3r"><meta property="og:url" content="https://bwrg3r.github.io/blog/umcsctf2025-finals/"><meta property="og:author" content="hoezhiwan, gr1d, w_11, bakayang"><meta name="twitter:title" content="UMCS CTF 2025 Finals"><meta name="twitter:description" content="A compilation of UMCS CTF 2025 Finals Writeups"><meta property="twitter:image" content="https://bwrg3r.github.io//_astro/logo.BVICYRoW.png"><meta name="twitter:image:alt" content="UMCS CTF 2025 Finals"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="hoezhiwan, gr1d, w_11, bakayang"><meta property="article:tag" content="UMCSCTF"><link rel="stylesheet" href="/_astro/about.XcDCj8Bj.css"></head><body> <div class="flex h-fit min-h-screen flex-col gap-y-6 font-sans"> <header class="bg-background/50 sticky top-0 z-10 backdrop-blur-md" data-astro-transition-persist="astro-l7r54iwe-1"> <div class="mx-auto flex max-w-3xl flex-wrap items-center justify-between gap-4 p-4"> <a href="/" target="_self" class="transition-colors duration-300 ease-in-out flex shrink-0 items-center gap-2 text-xl font-medium">  <img src="/_astro/logo.dZyzI5SQ_Z1esfTx.svg" alt="Logo" width="512" height="512" loading="lazy" decoding="async" class="size-8"> bWrg3r </a> <div class="flex items-center gap-2 md:gap-4"> <nav class="hidden items-center gap-4 text-sm sm:gap-6 md:flex"> <a href="/blog" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground/80 capitalize transition-colors"> blog </a><a href="/authors" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground/80 capitalize transition-colors"> authors </a><a href="/about" target="_self" class="inline-block duration-300 ease-in-out text-foreground/60 hover:text-foreground/80 capitalize transition-colors"> about </a> </nav> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="1WHFEf" prefix="r0" component-url="/_astro/mobile-menu.Dhpokw_i.js" component-export="default" renderer-url="/_astro/client.DXT7MGXl.js" props="{&quot;data-astro-transition-persist&quot;:[0,&quot;astro-mepp556t-2&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;MobileMenu&quot;,&quot;value&quot;:true}" data-astro-transition-persist="astro-mepp556t-2" await-children><button data-slot="dropdown-menu-trigger" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 md:hidden" title="Menu" type="button" id="radix-:r0R0:" aria-haspopup="menu" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-5 w-5"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg><span class="sr-only">Toggle menu</span></button><!--astro:end--></astro-island> <button data-slot="button" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" id="theme-toggle" title="Toggle theme"> <svg width="1em" height="1em" class="size-4 scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90" data-icon="lucide:sun">   <symbol id="ai:lucide:sun" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></symbol><use href="#ai:lucide:sun"></use>  </svg> <svg width="1em" height="1em" class="absolute size-4 scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0" data-icon="lucide:moon">   <symbol id="ai:lucide:moon" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3a6 6 0 0 0 9 9a9 9 0 1 1-9-9"/></symbol><use href="#ai:lucide:moon"></use>  </svg> <span class="sr-only">Toggle theme</span> </button> <script data-astro-rerun>
  const theme = (() => {
    const localStorageTheme = localStorage?.getItem('theme') ?? ''
    if (['dark', 'light'].includes(localStorageTheme)) {
      return localStorageTheme
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark'
    }
    return 'light'
  })()

  if (theme === 'light') {
    document.documentElement.classList.remove('dark')
  } else {
    document.documentElement.classList.add('dark')
  }

  window.localStorage.setItem('theme', theme)
</script> <script type="module">function a(){const e=document.documentElement;e.classList.add("disable-transitions"),e.classList.toggle("dark"),window.getComputedStyle(e).getPropertyValue("opacity"),requestAnimationFrame(()=>{e.classList.remove("disable-transitions")});const t=e.classList.contains("dark");localStorage.setItem("theme",t?"dark":"light")}function s(){const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",a)}s();document.addEventListener("astro:after-swap",()=>{const e=localStorage.getItem("theme"),t=document.documentElement;t.classList.add("disable-transitions"),window.getComputedStyle(t).getPropertyValue("opacity"),e==="dark"?t.classList.add("dark"):t.classList.remove("dark"),requestAnimationFrame(()=>{t.classList.remove("disable-transitions")}),s()});</script> </div> </div> </header> <main class="grow"> <div class="mx-auto flex grow flex-col gap-y-6 px-4">   <section class="grid grid-cols-[minmax(0px,1fr)_min(calc(var(--breakpoint-md)-2rem),100%)_minmax(0px,1fr)] gap-y-6"> <div class="col-start-2"> <nav aria-label="breadcrumb" data-slot="breadcrumb"> <ol data-slot="breadcrumb-list" class="text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5"> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"> <a data-slot="breadcrumb-link" class="hover:text-foreground transition-colors" href="/"> <svg width="1em" height="1em" class="size-4" data-icon="lucide:home">   <symbol id="ai:lucide:home" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></g></symbol><use href="#ai:lucide:home"></use>  </svg> </a> </li>  <li data-slot="breadcrumb-separator" role="presentation" aria-hidden="true" class="[&amp;&gt;svg]:size-3.5"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.1584 3.13508C6.35985 2.94621 6.67627 2.95642 6.86514 3.15788L10.6151 7.15788C10.7954 7.3502 10.7954 7.64949 10.6151 7.84182L6.86514 11.8418C6.67627 12.0433 6.35985 12.0535 6.1584 11.8646C5.95694 11.6757 5.94673 11.3593 6.1356 11.1579L9.565 7.49985L6.1356 3.84182C5.94673 3.64036 5.95694 3.32394 6.1584 3.13508Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></li> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"><a data-slot="breadcrumb-link" class="hover:text-foreground transition-colors" href="/blog"> <span class="flex items-center gap-x-2"> <svg width="1em" height="1em" class="size-4" data-icon="lucide:archive">   <symbol id="ai:lucide:archive" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><rect width="20" height="5" x="2" y="3" rx="1"/><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8m-10 4h4"/></g></symbol><use href="#ai:lucide:archive"></use>  </svg> Blog </span> </a></li>  <li data-slot="breadcrumb-separator" role="presentation" aria-hidden="true" class="[&amp;&gt;svg]:size-3.5"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.1584 3.13508C6.35985 2.94621 6.67627 2.95642 6.86514 3.15788L10.6151 7.15788C10.7954 7.3502 10.7954 7.64949 10.6151 7.84182L6.86514 11.8418C6.67627 12.0433 6.35985 12.0535 6.1584 11.8646C5.95694 11.6757 5.94673 11.3593 6.1356 11.1579L9.565 7.49985L6.1356 3.84182C5.94673 3.64036 5.95694 3.32394 6.1584 3.13508Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></li> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"><span data-slot="breadcrumb-page" role="link" aria-disabled="true" aria-current="page" class="text-foreground font-normal"> <span class="flex items-center gap-x-2"> <svg width="1em" height="1em" class="size-4" data-icon="lucide:file-text">   <symbol id="ai:lucide:file-text" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4M10 9H8m8 4H8m8 4H8"/></g></symbol><use href="#ai:lucide:file-text"></use>  </svg> UMCS CTF 2025 Finals </span> </span></li> </ol> </nav> </div> <img src="/_astro/logo.BVICYRoW_Z1Fnbp3.webp" alt="UMCS CTF 2025 Finals" width="1200" height="630" loading="lazy" decoding="async" class="col-span-full mx-auto w-full max-w-5xl object-cover"> <section class="col-start-2 flex flex-col gap-y-6 text-center"> <div class="flex flex-col"> <h1 class="mb-2 text-4xl leading-tight font-medium text-pretty sm:text-5xl"> UMCS CTF 2025 Finals </h1> <div class="text-muted-foreground mb-4 flex flex-wrap items-center justify-center gap-2 text-sm">  <div class="flex items-center gap-x-2"> <div class="flex items-center gap-x-1.5"> <img src="https://avatars.githubusercontent.com/u/89591638?v=4" alt="hoezhiwan" width="24" height="24" loading="lazy" decoding="async" class="rounded-full"> <a href="/authors/hoezhiwan" target="_self" class="inline-block transition-colors duration-300 ease-in-out underline decoration-muted-foreground underline-offset-[3px] hover:decoration-foreground text-foreground">  <span>hoezhiwan</span>  </a> </div><div class="flex items-center gap-x-1.5"> <img src="https://avatars.githubusercontent.com/u/83480366?v=4" alt="gr1d" width="24" height="24" loading="lazy" decoding="async" class="rounded-full"> <a href="/authors/gr1d" target="_self" class="inline-block transition-colors duration-300 ease-in-out underline decoration-muted-foreground underline-offset-[3px] hover:decoration-foreground text-foreground">  <span>gr1d</span>  </a> </div><div class="flex items-center gap-x-1.5"> <img src="https://avatars.githubusercontent.com/u/130538576?v=4" alt="w_11" width="24" height="24" loading="lazy" decoding="async" class="rounded-full"> <a href="/authors/w_11" target="_self" class="inline-block transition-colors duration-300 ease-in-out underline decoration-muted-foreground underline-offset-[3px] hover:decoration-foreground text-foreground">  <span>w_11</span>  </a> </div><div class="flex items-center gap-x-1.5"> <img src="https://bakayang.vercel.app/images/kirby.png" alt="bakayang" width="24" height="24" loading="lazy" decoding="async" class="rounded-full"> <a href="/authors/bakayang" target="_self" class="inline-block transition-colors duration-300 ease-in-out underline decoration-muted-foreground underline-offset-[3px] hover:decoration-foreground text-foreground">  <span>bakayang</span>  </a> </div> </div> <div data-orientation="vertical" role="none" data-slot="separator-root" class="bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px h-4!"></div>  <div class="flex items-center gap-2"> <span>May 17, 2025</span> <div data-orientation="vertical" role="none" data-slot="separator-root" class="bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px h-4!"></div> <span>5 min read</span> </div> </div> <div class="flex flex-wrap justify-center gap-2"> <a href="/tags/UMCSCTF" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary text-secondary-foreground [a&#38;]:hover:bg-secondary/90"> <svg width="1em" height="1em" class="size-3" data-icon="lucide:hash">   <symbol id="ai:lucide:hash" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 9h16M4 15h16M10 3L8 21m8-18l-2 18"/></symbol><use href="#ai:lucide:hash"></use>  </svg> UMCSCTF </a> </div> </div> <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="#" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-xl group flex items-center justify-start size-full pointer-events-none opacity-50 cursor-not-allowed" aria-disabled="true">  <svg width="1em" height="1em" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <symbol id="ai:lucide:arrow-left" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19l-7-7l7-7m7 7H5"/></symbol><use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs">Next Post</span> <span class="w-full text-left text-sm text-ellipsis"> Latest post! </span> </div>  </a> <a href="/blog/bbctf2025" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-xl group flex items-center justify-end size-full" aria-disabled="false">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs">Previous Post</span> <span class="w-full text-right text-sm text-ellipsis"> BBCTF 2025 </span> </div> <svg width="1em" height="1em" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <symbol id="ai:lucide:arrow-right" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7l-7 7"/></symbol><use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <details open class="group col-start-2 rounded-xl border p-4 xl:sticky xl:top-20 xl:col-start-1 xl:mr-8 xl:ml-auto xl:h-[calc(100vh-5rem)] xl:max-w-fit xl:rounded-none xl:border-none xl:p-0"> <summary class="flex cursor-pointer items-center justify-between text-xl font-medium group-open:pb-4 xl:hidden"> <span>Table of Contents</span> <svg width="1em" height="1em" class="size-5 shrink-0 transition-transform group-open:rotate-180" data-icon="lucide:chevron-down">   <symbol id="ai:lucide:chevron-down" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9l6 6l6-6"/></symbol><use href="#ai:lucide:chevron-down"></use>  </svg> </summary> <astro-island uid="ZdlOfC" prefix="r1" component-url="/_astro/scroll-area.Cu-_yt5l.js" component-export="ScrollArea" renderer-url="/_astro/client.DXT7MGXl.js" props="{&quot;className&quot;:[0,&quot;flex max-h-64 flex-col overflow-y-auto xl:max-h-[calc(100vh-8rem)]&quot;],&quot;type&quot;:[0,&quot;always&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative flex max-h-64 flex-col overflow-y-auto xl:max-h-[calc(100vh-8rem)]" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot> <ul class="flex list-none flex-col gap-y-2 px-4 xl:mr-8" id="table-of-contents"> <li class="hidden text-lg font-medium xl:block">Table of Contents</li> <li class="text-foreground/60 px-4 text-sm xl:p-0"> <a href="#crypto" class="marker:text-foreground/30 list-item list-disc underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit xl:list-none"> [Crypto] </a> </li><li class="text-foreground/60 px-4 text-sm xl:p-0"> <a href="#quantum-web-token" class="marker:text-foreground/30 list-item list-disc underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit xl:list-none"> Quantum-Web-Token </a> </li><li class="text-foreground/60 px-4 text-sm xl:p-0"> <a href="#solve-script" class="marker:text-foreground/30 list-item list-disc underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit xl:list-none"> Solve Script </a> </li> </ul> </astro-slot></div></div><div data-orientation="vertical" data-slot="scroll-area-scrollbar" class="flex touch-none p-px transition-colors select-none h-full w-2.5 border-l border-l-transparent" style="position:absolute;top:0;right:0;bottom:var(--radix-scroll-area-corner-height);--radix-scroll-area-thumb-height:18px"></div></div><!--astro:end--></astro-island> </details> <script type="module">function s(){const t=document.querySelector("header"),c=t?t.offsetHeight:0,a=new IntersectionObserver(e=>{e.forEach(o=>{const r=o.target.querySelector("h2, h3, h4, h5, h6");if(!r)return;const d=r.getAttribute("id"),n=document.querySelector(`#table-of-contents li a[href="#${d}"]`);if(!n)return;const i=o.isIntersecting?"add":"remove";n.classList[i]("text-foreground")})},{rootMargin:`-${c}px 0px 0px 0px`});document.querySelectorAll(".prose section").forEach(e=>{a.observe(e)})}document.addEventListener("astro:page-load",s);document.addEventListener("astro:after-swap",s);</script> <article class="prose col-start-2 max-w-none"> <section><h1 id="crypto">[Crypto]</h1><section><h2 id="quantum-web-token">Quantum-Web-Token</h2><ul>
<li>Implements BB84 quantum key distribution protocol</li>
<li>Uses Qiskit for quantum circuit simulation</li>
<li>Uses JWT (JSON Web Tokens) for communication</li>
<li>Involves 32 qubits per round</li>
<li>Goal: We need to guess Bob’s measured bits (r_bits) correctly to get the flag</li>
</ul><p>The vulnerability was indeed that <code>s_bits</code> (Alice’s secret bits) were not regenerated for each new connection or session, allowing us to collect them over multiple rounds. Once all <code>s_bits</code>were known, we could use the xor values from the last round’s qwt tokens to determine Bob’s measured bits <code>r_bits</code> and submit the correct guess.</p><p><img src="/_astro/flag.BFHOjoLz_ZSSkV7.webp" alt width="1176" height="516" loading="lazy" decoding="async"></p></section></section>
<section><h1 id="solve-script">Solve Script</h1><div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.mfnqe.css"/><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:148ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6">#!/usr/bin/env python3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6"># Solution for quantum-web-token CTF challenge</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">from</span><span style="--0:#24292E;--1:#E1E4E8"> pwn </span><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#616972;--1:#99A0A6"># Using pwntools for connection convenience</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> base64</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> json</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">import</span><span style="--0:#24292E;--1:#E1E4E8"> time</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#616972;--1:#99A0A6"># JWT decoding function</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">def</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">decode_jwt_payload_segment</span><span style="--0:#24292E;--1:#E1E4E8">(payload_b64_str: </span><span style="--0:#005CC5;--1:#79B8FF">str</span><span style="--0:#24292E;--1:#E1E4E8">) -&gt; </span><span style="--0:#005CC5;--1:#79B8FF">dict</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">    </span></span><span style="--0:#032F62;--1:#9ECBFF">Decodes the payload segment of a JWT token.</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">    </span></span><span style="--0:#032F62;--1:#9ECBFF">The input is the base64url encoded payload string (middle part of JWT).</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#032F62;--1:#9ECBFF">    </span></span><span style="--0:#032F62;--1:#9ECBFF">&quot;&quot;&quot;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#616972;--1:#99A0A6"># Add padding if necessary for base64url decoding</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">padded_payload_b64_str </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> payload_b64_str </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;=&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> (</span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#005CC5;--1:#79B8FF">len</span><span style="--0:#24292E;--1:#E1E4E8">(payload_b64_str) </span><span style="--0:#BF3441;--1:#F97583">%</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">4</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">payload_json_bytes </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> base64.urlsafe_b64decode(padded_payload_b64_str)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> json.loads(payload_json_bytes.decode(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;utf-8&#39;</span><span style="--0:#24292E;--1:#E1E4E8">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">def</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">solve</span><span style="--0:#24292E;--1:#E1E4E8">(max_retries</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8">, initial_timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">15</span><span style="--0:#24292E;--1:#E1E4E8">, per_line_timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">10</span><span style="--0:#24292E;--1:#E1E4E8">, recv_timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#005CC5;--1:#79B8FF">10</span><span style="--0:#24292E;--1:#E1E4E8">): </span><span style="--0:#616972;--1:#99A0A6"># Increased timeouts</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> attempt </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(max_retries):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Starting attempt </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">attempt </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1}</span><span style="--0:#032F62;--1:#9ECBFF">/</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">max_retries</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">        </span></span><span style="--0:#24292E;--1:#E1E4E8">conn </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8">  </span><span style="--0:#616972;--1:#99A0A6"># Initialize conn to None</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">try</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">            </span><span style="--0:#616972;--1:#99A0A6"># Set up pwntools context for quieter output or debugging</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">            </span><span style="--0:#616972;--1:#99A0A6"># context.log_level = &#39;debug&#39; # Uncomment for verbose pwntools output</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">context.log_level </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;info&#39;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">            </span><span style="--0:#616972;--1:#99A0A6"># conn = remote(&quot;localhost&quot;, 5001) # For local testing</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">conn </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> remote(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;116.203.176.73&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#005CC5;--1:#79B8FF">5001</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">initial_timeout)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Connected to server.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">            </span><span style="--0:#616972;--1:#99A0A6"># Receive welcome message</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">welcome_msg </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn.recvuntil(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Sending qubits through quantum channel:</span><span style="--0:#005CC5;--1:#79B8FF">\n</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">recv_timeout)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Welcome message received: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">welcome_msg.decode().strip()</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">time.sleep(</span><span style="--0:#005CC5;--1:#79B8FF">0.5</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#616972;--1:#99A0A6"># Add a small delay after welcome, before server sends JWTs</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">n_qubits </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">32</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">s_bits_master </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> [</span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> n_qubits </span><span style="--0:#616972;--1:#99A0A6"># Stores the known s_bits from Alice</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">num_s_bits_known </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">current_round_xors </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> [</span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> n_qubits </span><span style="--0:#616972;--1:#99A0A6"># Stores XOR values for the current round (needs to be accessible after loop)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">round_num </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">            </span><span style="--0:#616972;--1:#99A0A6"># Loop until all of Alice&#39;s s_bits are known</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">            </span><span style="--0:#BF3441;--1:#F97583">while</span><span style="--0:#24292E;--1:#E1E4E8"> num_s_bits_known </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> n_qubits:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">round_num </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Starting Round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">. Known s_bits: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">num_s_bits_known</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">/</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">n_qubits</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">                </span><span style="--0:#616972;--1:#99A0A6"># 1. Receive n_qubits qwt JWTs (individual qubit info)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(n_qubits):</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">try</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">jwt_line_bytes </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn.recvline(</span><span style="--0:#AE4B07;--1:#FFAB70">timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">per_line_timeout)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">                        </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">not</span><span style="--0:#24292E;--1:#E1E4E8"> jwt_line_bytes:</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Connection closed prematurely while reading qwt JWT </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF"> in round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">                            </span><span style="--0:#BF3441;--1:#F97583">raise</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">EOFError</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Connection closed by server&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">jwt_line </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> jwt_line_bytes.strip().decode()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">                        </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> jwt_line.count(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;.&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Received malformed JWT in round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">, JWT </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">jwt_line</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">                            </span><span style="--0:#BF3441;--1:#F97583">raise</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">ValueError</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Malformed JWT received&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">payload_b64_str </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> jwt_line.split(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;.&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">]</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">payload </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> decode_jwt_payload_segment(payload_b64_str)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">current_round_xors[i] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> payload[</span><span style="--0:#032F62;--1:#9ECBFF">&#39;xor&#39;</span><span style="--0:#24292E;--1:#E1E4E8">]</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">Exception</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Error processing qwt JWT </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF"> in round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">problematic_line </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> jwt_line_bytes </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;jwt_line_bytes&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">locals</span><span style="--0:#24292E;--1:#E1E4E8">() </span><span style="--0:#BF3441;--1:#F97583">and</span><span style="--0:#24292E;--1:#E1E4E8"> jwt_line_bytes </span><span style="--0:#BF3441;--1:#F97583">is</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">not</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;N/A&#39;</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Problematic JWT line (if any): </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">problematic_line.decode(</span><span style="--0:#AE4B07;--1:#FFAB70">errors</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#032F62;--1:#9ECBFF">&#39;ignore&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">                        </span><span style="--0:#BF3441;--1:#F97583">raise</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">: Received all </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">n_qubits</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF"> qwt JWTs.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">                </span><span style="--0:#616972;--1:#99A0A6"># 2. Receive p_key JWT (sifted key info)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">try</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">pkey_jwt_line_bytes </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn.recvline(</span><span style="--0:#AE4B07;--1:#FFAB70">timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">per_line_timeout)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">not</span><span style="--0:#24292E;--1:#E1E4E8"> pkey_jwt_line_bytes:</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Connection closed prematurely while reading pkey JWT in round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent">                        </span><span style="--0:#BF3441;--1:#F97583">raise</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">EOFError</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Connection closed by server&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">pkey_jwt_line </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> pkey_jwt_line_bytes.strip().decode()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> pkey_jwt_line.count(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;.&#39;</span><span style="--0:#24292E;--1:#E1E4E8">) </span><span style="--0:#BF3441;--1:#F97583">!=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">2</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Received malformed pkey JWT in round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">pkey_jwt_line</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">                        </span><span style="--0:#BF3441;--1:#F97583">raise</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">ValueError</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Malformed pkey JWT received&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">pkey_payload_b64_str </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> pkey_jwt_line.split(</span><span style="--0:#032F62;--1:#9ECBFF">&#39;.&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)[</span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">]</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">pkey_payload </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> decode_jwt_payload_segment(pkey_payload_b64_str)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">Exception</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Error processing pkey JWT in round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">problematic_pkey_line </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> pkey_jwt_line_bytes </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;pkey_jwt_line_bytes&#39;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">locals</span><span style="--0:#24292E;--1:#E1E4E8">() </span><span style="--0:#BF3441;--1:#F97583">and</span><span style="--0:#24292E;--1:#E1E4E8"> pkey_jwt_line_bytes </span><span style="--0:#BF3441;--1:#F97583">is</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">not</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&#39;N/A&#39;</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Problematic pkey JWT line (if any): </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">problematic_pkey_line.decode(</span><span style="--0:#AE4B07;--1:#FFAB70">errors</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#032F62;--1:#9ECBFF">&#39;ignore&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">raise</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">new_bits_learned_this_round </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">0</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> idx_str, bit_val </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> pkey_payload.items():</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">idx </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">int</span><span style="--0:#24292E;--1:#E1E4E8">(idx_str)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> s_bits_master[idx] </span><span style="--0:#BF3441;--1:#F97583">is</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">s_bits_master[idx] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> bit_val</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">num_s_bits_known </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                        </span></span><span style="--0:#24292E;--1:#E1E4E8">new_bits_learned_this_round </span><span style="--0:#BF3441;--1:#F97583">+=</span><span style="--0:#005CC5;--1:#79B8FF">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">: Learned </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">new_bits_learned_this_round</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF"> new s_bits. Total known: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">num_s_bits_known</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">/</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">n_qubits</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent">                </span><span style="--0:#616972;--1:#99A0A6"># 3. Decide whether to continue to another round or stop</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">try</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">prompt </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn.recvuntil(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Do you want somemore tokens? (y/n): &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">recv_timeout).decode()</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">Exception</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Error receiving &#39;more tokens&#39; prompt in round </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">round_num</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">raise</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> num_s_bits_known </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> n_qubits:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;All s_bits are known. Sending &#39;n&#39; to stop receiving tokens.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">conn.sendline(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;n&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">break</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">conn.sendline(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;y&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;All s_bits collected. Calculating the final r_bits (Bob&#39;s measured bits).&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">r_bits_final </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> [</span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8">] </span><span style="--0:#BF3441;--1:#F97583">*</span><span style="--0:#24292E;--1:#E1E4E8"> n_qubits</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code"><span class="indent">            </span><span style="--0:#BF3441;--1:#F97583">for</span><span style="--0:#24292E;--1:#E1E4E8"> i </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">range</span><span style="--0:#24292E;--1:#E1E4E8">(n_qubits):</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> s_bits_master[i] </span><span style="--0:#BF3441;--1:#F97583">is</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Critical error: s_bits_master[</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">] is None even after loop completion.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">raise</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">ValueError</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;s_bits_master[</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">] is None&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> current_round_xors[i] </span><span style="--0:#BF3441;--1:#F97583">is</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">None</span><span style="--0:#24292E;--1:#E1E4E8">: </span><span style="--0:#616972;--1:#99A0A6"># Should not happen if logic is correct</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">126</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Critical error: current_round_xors[</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">] is None before final calculation.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">127</div></div><div class="code"><span class="indent">                    </span><span style="--0:#BF3441;--1:#F97583">raise</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">ValueError</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;current_round_xors[</span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">i</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">] is None&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">128</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">r_bits_final[i] </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> s_bits_master[i] </span><span style="--0:#BF3441;--1:#F97583">^</span><span style="--0:#24292E;--1:#E1E4E8"> current_round_xors[i]</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">129</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">130</div></div><div class="code"><span class="indent">            </span><span style="--0:#BF3441;--1:#F97583">try</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">131</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">guess_prompt </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn.recvuntil(</span><span style="--0:#BF3441;--1:#F97583">b</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Guess Bob&#39;s qubits (comma as delimeter): &quot;</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">recv_timeout).decode()</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">132</div></div><div class="code"><span class="indent">            </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">Exception</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">133</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Error receiving &#39;guess&#39; prompt: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">134</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">raise</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">135</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">136</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">guess_str </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;,&quot;</span><span style="--0:#24292E;--1:#E1E4E8">.join(</span><span style="--0:#005CC5;--1:#79B8FF">map</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#005CC5;--1:#79B8FF">str</span><span style="--0:#24292E;--1:#E1E4E8">, r_bits_final))</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">137</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Sending guess: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">guess_str</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">138</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">conn.sendline(guess_str.encode())</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">139</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">140</div></div><div class="code"><span class="indent">            </span><span style="--0:#BF3441;--1:#F97583">try</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">141</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">result_bytes </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> conn.recvall(</span><span style="--0:#AE4B07;--1:#FFAB70">timeout</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8">recv_timeout </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">10</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">142</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">result </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> result_bytes.decode(</span><span style="--0:#AE4B07;--1:#FFAB70">errors</span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#032F62;--1:#9ECBFF">&#39;ignore&#39;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">143</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Server response:</span><span style="--0:#005CC5;--1:#79B8FF">\n{</span><span style="--0:#24292E;--1:#E1E4E8">result</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">144</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;UMCS{&quot;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> result:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">145</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.success(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Flag captured!&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">146</div></div><div class="code"><span class="indent">                    </span><span style="--0:#005CC5;--1:#79B8FF">print</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;FLAG: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">result.strip()</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">147</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">elif</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;worst guess ever&quot;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">in</span><span style="--0:#24292E;--1:#E1E4E8"> result:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">148</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Guess was incorrect.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">149</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">150</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.warning(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Flag not found in the response, and no explicit failure message.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">151</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">return</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">152</div></div><div class="code"><span class="indent">            </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">Exception</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">153</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">                </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Error receiving final result: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">154</div></div><div class="code"><span class="indent">                </span><span style="--0:#BF3441;--1:#F97583">raise</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">155</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">156</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">EOFError</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">157</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;EOFError during attempt </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">attempt </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">. Server closed connection.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">158</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> PwnlibException </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">159</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;PwnlibException during attempt </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">attempt </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">160</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">ValueError</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">161</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;ValueError during attempt </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">attempt </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">162</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">except</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">Exception</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">as</span><span style="--0:#24292E;--1:#E1E4E8"> e:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">163</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;An unexpected error occurred during attempt </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">attempt </span><span style="--0:#BF3441;--1:#F97583">+</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1}</span><span style="--0:#032F62;--1:#9ECBFF">: </span><span style="--0:#005CC5;--1:#79B8FF">{type</span><span style="--0:#24292E;--1:#E1E4E8">(e).</span><span style="--0:#005CC5;--1:#79B8FF">__name__}</span><span style="--0:#032F62;--1:#9ECBFF"> - </span><span style="--0:#005CC5;--1:#79B8FF">{</span><span style="--0:#24292E;--1:#E1E4E8">e</span><span style="--0:#005CC5;--1:#79B8FF">}</span><span style="--0:#032F62;--1:#9ECBFF">&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">164</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">165</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> conn:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">166</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">conn.close()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">167</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">168</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> attempt </span><span style="--0:#BF3441;--1:#F97583">&lt;</span><span style="--0:#24292E;--1:#E1E4E8"> max_retries </span><span style="--0:#BF3441;--1:#F97583">-</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">169</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#BF3441;--1:#F97583">f</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Retrying in 5 seconds...&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">170</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">time.sleep(</span><span style="--0:#005CC5;--1:#79B8FF">5</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">171</div></div><div class="code"><span class="indent">        </span><span style="--0:#BF3441;--1:#F97583">else</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">172</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">            </span></span><span style="--0:#24292E;--1:#E1E4E8">log.error(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;All retries failed.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">173</div></div><div class="code"><span class="indent">            </span><span style="--0:#BF3441;--1:#F97583">break</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">174</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">175</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">log.info(</span><span style="--0:#032F62;--1:#9ECBFF">&quot;Solver finished.&quot;</span><span style="--0:#24292E;--1:#E1E4E8">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">176</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">177</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">__name__</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&#39;__main__&#39;</span><span style="--0:#24292E;--1:#E1E4E8">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">178</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">    </span></span><span style="--0:#24292E;--1:#E1E4E8">solve()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env python3# Solution for quantum-web-token CTF challengefrom pwn import * # Using pwntools for connection convenienceimport base64import jsonimport time# JWT decoding functiondef decode_jwt_payload_segment(payload_b64_str: str) -> dict:    &#34;&#34;&#34;    Decodes the payload segment of a JWT token.    The input is the base64url encoded payload string (middle part of JWT).    &#34;&#34;&#34;    # Add padding if necessary for base64url decoding    padded_payload_b64_str = payload_b64_str + '=' * (-len(payload_b64_str) % 4)    payload_json_bytes = base64.urlsafe_b64decode(padded_payload_b64_str)    return json.loads(payload_json_bytes.decode('utf-8'))def solve(max_retries=5, initial_timeout=15, per_line_timeout=10, recv_timeout=10): # Increased timeouts    for attempt in range(max_retries):        log.info(f&#34;Starting attempt {attempt + 1}/{max_retries}&#34;)        conn = None  # Initialize conn to None        try:            # Set up pwntools context for quieter output or debugging            # context.log_level = 'debug' # Uncomment for verbose pwntools output            context.log_level = 'info'            # conn = remote(&#34;localhost&#34;, 5001) # For local testing            conn = remote(&#34;116.203.176.73&#34;, 5001, timeout=initial_timeout)            log.info(&#34;Connected to server.&#34;)            # Receive welcome message            welcome_msg = conn.recvuntil(b&#34;Sending qubits through quantum channel:\n&#34;, timeout=recv_timeout)            log.info(f&#34;Welcome message received: {welcome_msg.decode().strip()}&#34;)            time.sleep(0.5) # Add a small delay after welcome, before server sends JWTs            n_qubits = 32            s_bits_master = [None] * n_qubits # Stores the known s_bits from Alice            num_s_bits_known = 0            current_round_xors = [None] * n_qubits # Stores XOR values for the current round (needs to be accessible after loop)            round_num = 0            # Loop until all of Alice's s_bits are known            while num_s_bits_known < n_qubits:                round_num += 1                log.info(f&#34;Starting Round {round_num}. Known s_bits: {num_s_bits_known}/{n_qubits}&#34;)                # 1. Receive n_qubits qwt JWTs (individual qubit info)                for i in range(n_qubits):                    try:                        jwt_line_bytes = conn.recvline(timeout=per_line_timeout)                        if not jwt_line_bytes:                            log.error(f&#34;Connection closed prematurely while reading qwt JWT {i} in round {round_num}.&#34;)                            raise EOFError(&#34;Connection closed by server&#34;)                        jwt_line = jwt_line_bytes.strip().decode()                        if jwt_line.count('.') != 2:                            log.error(f&#34;Received malformed JWT in round {round_num}, JWT {i}: {jwt_line}&#34;)                            raise ValueError(&#34;Malformed JWT received&#34;)                        payload_b64_str = jwt_line.split('.')[1]                        payload = decode_jwt_payload_segment(payload_b64_str)                        current_round_xors[i] = payload['xor']                    except Exception as e:                        log.error(f&#34;Error processing qwt JWT {i} in round {round_num}: {e}&#34;)                        problematic_line = jwt_line_bytes if 'jwt_line_bytes' in locals() and jwt_line_bytes is not None else b'N/A'                        log.error(f&#34;Problematic JWT line (if any): {problematic_line.decode(errors='ignore')}&#34;)                        raise                log.info(f&#34;Round {round_num}: Received all {n_qubits} qwt JWTs.&#34;)                # 2. Receive p_key JWT (sifted key info)                try:                    pkey_jwt_line_bytes = conn.recvline(timeout=per_line_timeout)                    if not pkey_jwt_line_bytes:                        log.error(f&#34;Connection closed prematurely while reading pkey JWT in round {round_num}.&#34;)                        raise EOFError(&#34;Connection closed by server&#34;)                    pkey_jwt_line = pkey_jwt_line_bytes.strip().decode()                    if pkey_jwt_line.count('.') != 2:                        log.error(f&#34;Received malformed pkey JWT in round {round_num}: {pkey_jwt_line}&#34;)                        raise ValueError(&#34;Malformed pkey JWT received&#34;)                    pkey_payload_b64_str = pkey_jwt_line.split('.')[1]                    pkey_payload = decode_jwt_payload_segment(pkey_payload_b64_str)                except Exception as e:                    log.error(f&#34;Error processing pkey JWT in round {round_num}: {e}&#34;)                    problematic_pkey_line = pkey_jwt_line_bytes if 'pkey_jwt_line_bytes' in locals() and pkey_jwt_line_bytes is not None else b'N/A'                    log.error(f&#34;Problematic pkey JWT line (if any): {problematic_pkey_line.decode(errors='ignore')}&#34;)                    raise                new_bits_learned_this_round = 0                for idx_str, bit_val in pkey_payload.items():                    idx = int(idx_str)                    if s_bits_master[idx] is None:                        s_bits_master[idx] = bit_val                        num_s_bits_known += 1                        new_bits_learned_this_round +=1                log.info(f&#34;Round {round_num}: Learned {new_bits_learned_this_round} new s_bits. Total known: {num_s_bits_known}/{n_qubits}&#34;)                # 3. Decide whether to continue to another round or stop                try:                    prompt = conn.recvuntil(b&#34;Do you want somemore tokens? (y/n): &#34;, timeout=recv_timeout).decode()                except Exception as e:                    log.error(f&#34;Error receiving 'more tokens' prompt in round {round_num}: {e}&#34;)                    raise                if num_s_bits_known == n_qubits:                    log.info(&#34;All s_bits are known. Sending 'n' to stop receiving tokens.&#34;)                    conn.sendline(b&#34;n&#34;)                    break                else:                    conn.sendline(b&#34;y&#34;)            log.info(&#34;All s_bits collected. Calculating the final r_bits (Bob's measured bits).&#34;)            r_bits_final = [None] * n_qubits            for i in range(n_qubits):                if s_bits_master[i] is None:                    log.error(f&#34;Critical error: s_bits_master[{i}] is None even after loop completion.&#34;)                    raise ValueError(f&#34;s_bits_master[{i}] is None&#34;)                if current_round_xors[i] is None: # Should not happen if logic is correct                    log.error(f&#34;Critical error: current_round_xors[{i}] is None before final calculation.&#34;)                    raise ValueError(f&#34;current_round_xors[{i}] is None&#34;)                r_bits_final[i] = s_bits_master[i] ^ current_round_xors[i]            try:                guess_prompt = conn.recvuntil(b&#34;Guess Bob's qubits (comma as delimeter): &#34;, timeout=recv_timeout).decode()            except Exception as e:                log.error(f&#34;Error receiving 'guess' prompt: {e}&#34;)                raise            guess_str = &#34;,&#34;.join(map(str, r_bits_final))            log.info(f&#34;Sending guess: {guess_str}&#34;)            conn.sendline(guess_str.encode())            try:                result_bytes = conn.recvall(timeout=recv_timeout + 10)                result = result_bytes.decode(errors='ignore')                log.info(f&#34;Server response:\n{result}&#34;)                if &#34;UMCS{&#34; in result:                    log.success(&#34;Flag captured!&#34;)                    print(f&#34;FLAG: {result.strip()}&#34;)                elif &#34;worst guess ever&#34; in result:                    log.error(&#34;Guess was incorrect.&#34;)                else:                    log.warning(&#34;Flag not found in the response, and no explicit failure message.&#34;)                return            except Exception as e:                log.error(f&#34;Error receiving final result: {e}&#34;)                raise        except EOFError as e:            log.error(f&#34;EOFError during attempt {attempt + 1}: {e}. Server closed connection.&#34;)        except PwnlibException as e:            log.error(f&#34;PwnlibException during attempt {attempt + 1}: {e}&#34;)        except ValueError as e:            log.error(f&#34;ValueError during attempt {attempt + 1}: {e}&#34;)        except Exception as e:            log.error(f&#34;An unexpected error occurred during attempt {attempt + 1}: {type(e).__name__} - {e}&#34;)        if conn:            conn.close()        if attempt < max_retries - 1:            log.info(f&#34;Retrying in 5 seconds...&#34;)            time.sleep(5)        else:            log.error(&#34;All retries failed.&#34;)            break    log.info(&#34;Solver finished.&#34;)if __name__ == '__main__':    solve()"><div></div></button></div></figure></div></section> </article> <nav class="col-start-2 grid grid-cols-1 gap-4 sm:grid-cols-2"> <a href="#" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-xl group flex items-center justify-start size-full pointer-events-none opacity-50 cursor-not-allowed" aria-disabled="true">  <svg width="1em" height="1em" viewBox="0 0 24 24" class="mr-2 size-4 transition-transform group-hover:-translate-x-1" data-icon="lucide:arrow-left">   <use href="#ai:lucide:arrow-left"></use>  </svg> <div class="flex flex-col items-start overflow-hidden text-wrap"> <span class="text-muted-foreground text-left text-xs">Next Post</span> <span class="w-full text-left text-sm text-ellipsis"> Latest post! </span> </div>  </a> <a href="/blog/bbctf2025" target="_self" class="duration-300 ease-in-out gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[>svg]:px-3 rounded-xl group flex items-center justify-end size-full" aria-disabled="false">  <div class="flex flex-col items-end overflow-hidden text-wrap"> <span class="text-muted-foreground text-right text-xs">Previous Post</span> <span class="w-full text-right text-sm text-ellipsis"> BBCTF 2025 </span> </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="ml-2 size-4 transition-transform group-hover:translate-x-1" data-icon="lucide:arrow-right">   <use href="#ai:lucide:arrow-right"></use>  </svg>  </a> </nav> </section> <button data-slot="button" class="items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 group fixed right-8 bottom-8 z-50 hidden" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top"> <svg width="1em" height="1em" class="mx-auto size-4 transition-all group-hover:-translate-y-0.5" data-icon="lucide:arrow-up">   <symbol id="ai:lucide:arrow-up" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12l7-7l7 7m-7 7V5"/></symbol><use href="#ai:lucide:arrow-up"></use>  </svg> </button> <script type="module">document.addEventListener("astro:page-load",()=>{const o=document.getElementById("scroll-to-top"),t=document.querySelector("footer");o&&t&&(o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",()=>{const e=t.getBoundingClientRect().top<=window.innerHeight;o.classList.toggle("hidden",window.scrollY<=300||e)}))});</script>  </div> </main> <footer class="py-4"> <div class="mx-auto flex max-w-3xl flex-col items-center justify-center gap-y-2 px-4 sm:flex-row sm:justify-between"> <div class="flex flex-wrap items-center justify-center gap-x-2 text-center"> <span class="text-muted-foreground text-sm">
&copy; 2025 bWrg3r | All rights reserved
</span> </div> <ul class="flex flex-wrap gap-2" role="list"> <li> <a href="https://github.com/bwrg3r" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="GitHub" title="GitHub">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:github">   <symbol id="ai:lucide:github" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5c.08-1.25-.27-2.48-1-3.5c.28-1.15.28-2.35 0-3.5c0 0-1 0-3 1.5c-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.4 5.4 0 0 0 4 9c0 3.5 3 5.5 6 5.5c-.39.49-.68 1.05-.85 1.65S8.93 17.38 9 18v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></g></symbol><use href="#ai:lucide:github"></use>  </svg>  </a> </li><li> <a href="https://mail.google.com/mail/?view=cm&fs=1&to=bwrg3r@gmail.com" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="Email" title="Email">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:mail">   <symbol id="ai:lucide:mail" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7l-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></g></symbol><use href="#ai:lucide:mail"></use>  </svg>  </a> </li><li> <a href="/rss.xml" target="_blank" class="duration-300 ease-in-out inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&#38;_svg]:pointer-events-none [&#38;_svg:not([class*='size-'])]:size-4 shrink-0 [&#38;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9" aria-label="RSS" title="RSS">  <svg width="1em" height="1em" class="size-4" data-icon="lucide:rss">   <symbol id="ai:lucide:rss" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 11a9 9 0 0 1 9 9M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></g></symbol><use href="#ai:lucide:rss"></use>  </svg>  </a> </li> </ul> </div> </footer> </div> </body></html>